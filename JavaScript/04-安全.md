# 1. XSS

## 1.1 什么

- 跨站脚本攻击
- 注入恶意代码
- 本质是没有对恶意代码进行过滤

## 1.2 分类

- 存储型：恶意代码提交到数据库中，用户请求时，将其拼接为html发给了客户
- 反射型：构建特殊URL，服务端从URL中获取数据，拼接到HTML后返回，导致恶意代码执行
- DOM型：构建特殊URL，用户打开网站后导致，JS脚本从URL获取数据，导致恶意代码执行

## 1.3 防范

- 输入端过滤：在输入时进行处理转义，效果不好，因为一个数据可能要在多个地方使用，无法准确判断哪些地方要转义回去
- 针对存储型和反射型：
  - 纯前端渲染，将代码和数据分开
    - 浏览器先加载一个静态 HTML，此 HTML 中不包含任何跟业务相关的数据。
    - 然后浏览器执行 HTML 中的 JavaScript。
    - JavaScript 通过 Ajax 加载业务数据，调用 DOM API 更新到页面上。
  - 对HTML做充分的转义
- 针对DOM型：
  - js代码不够严谨
  - 主要防范：.innerHTML`、`.outerHTML`、`document.write()
  - DOM 中的内联事件监听器，如 `location`、`onclick`、`onerror`、`onload`、`onmouseover` 等，
  - `<a>` 标签的 `href` 属性，
  - JavaScript 的 `eval()`、`setTimeout()`、`setInterval()` 等，都能把字符串作为代码运行。如果不可信的数据拼接到字符串中传递给这些 API，很容易产生安全隐患，请务必避免。